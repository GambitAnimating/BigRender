<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/html" xmlns="http://www.w3.org/1999/html">
<head>

	<title>BigRender</title>

	<script src="http://code.createjs.com/createjs-2013.05.14.min.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.5.1/underscore.js"></script>

	<!-- build:js scripts/Color.js -->
	<script src="scripts/Color.js"></script>
	<!-- endbuild -->

	<!-- build:js scripts/bigRender.js -->
	<script src="scripts/controller/CommandChainController.js"></script>
	<script src="scripts/controller/CompositionController.js"></script>
	<script src="scripts/controller/LayerForwarder.js"></script>
	<script src="scripts/controller/LayerManager.js"></script>

	<script src="scripts/model/CommandChainModel.js"></script>
	<script src="scripts/model/CompositionModel.js"></script>
	<script src="scripts/model/LayerModel.js"></script>

	<script src="scripts/utils/CanvasCache.js"></script>
	<script src="scripts/utils/CappedStorage.js"></script>
	<script src="scripts/utils/CommandDispatcher.js"></script>
	<script src="scripts/utils/Handy.js"></script>
	<script src="scripts/utils/ImageCache.js"></script>
	<script src="scripts/utils/ImageTinter.js"></script>
	<script src="scripts/utils/Maths.js"></script>
	<script src="scripts/utils/Queue.js"></script>
	<script src="scripts/utils/Task.js"></script>

	<script src="scripts/view/drawTools/ContextTools.js"></script>
	<script src="scripts/view/drawTools/ImageTools.js"></script>
	<script src="scripts/view/drawTools/LineTools.js"></script>
	<script src="scripts/view/drawTools/PixelTools.js"></script>
	<script src="scripts/view/drawTools/ShapeTools.js"></script>
	<script src="scripts/view/CompositionView.js"></script>
	<script src="scripts/view/LayerBitmapView.js"></script>
	<script src="scripts/view/LayerObjectView.js"></script>
	<script src="scripts/view/LayerView.js"></script>

	<script src="scripts/BigRender.js"></script>
	<script src="scripts/constants.js"></script>
	<!-- endbuild -->

</head>


<body style="background-color:lightgray">

	<a href="javascript:lineTest();">Line Test</a> |
	<a href="javascript:shapeTest();">Shape Test</a> |
	<a href="javascript:fillTest();">Flood Fill Test</a> |
	<a href="javascript:objTest();">Object Test</a> |
	<a href="javascript:longDrawTest();">Long Draw Test</a> |
	<a href="javascript:layerTest();">Layer Test</a>
	<br>
	<br>
	<h1 id="title"></h1>
	<canvas id="demo-canvas"></canvas>

	<script>
		var canvas = document.getElementById('demo-canvas');
		canvas.width = canvas.height = 200;
		var r = new bigRender.BigRender(canvas);

		lineTest();


		function setTitle(str) {
			document.getElementById('title').innerHTML = str;
		}


		function setupTest(title) {
			setTitle(title);
			endRandomScrolling();

			//clear out any shenanigans from previous tests
			r.clear();

			//create the layer we will draw on
			r.addCommand({type: bigRender.command.CREATE_LAYER, scrollPerc: 0});

			//draw a white background
			r.addCommand({type: bigRender.command.DRAW_SHAPE, shape: bigRender.shape.RECTANGLE, width: 200, height: 200, x: 100, y: 100, stroke: false, fill: true, fillStyle: '#FFFFFF'});
		}


		//draw test
		function lineTest() {
			setupTest('Line Test');

			//draw a line
			r.addCommand({type: bigRender.command.DRAW_LINE, path: [10,50,75,5,100,45,190,75], lineWidth: 5, strokeStyle: '#33FF55'});

			//draw a pixel line
			r.addCommand({type: bigRender.command.DRAW_LINE, path: [10,80,75,35,100,75,190,105], brush: bigRender.brush.PIXEL, fillStyle: '#FF0000'});

			//draw a line using an image
			r.addCommand({
				type: bigRender.command.DRAW_LINE,
				path: [10,115,75,70,100,110,190,140],
				brush: bigRender.brush.IMAGE,
				stepDist: .1,
				image: {
					src: 'img/brush.png',
					scaleX: 0.5,
					scaleY: 0.5,
					globalAlpha: 0.07,
					tintColor: '#123456',
					tintPerc: 1,
					rotation: 45
				}
			});

			//draw a line using a shape
			r.addCommand({
				type: bigRender.command.DRAW_LINE,
				path: [10,165,75,120,100,160,190,190],
				brush: bigRender.brush.SHAPE,
				stepDist: 10,
				shape: {
					shape: bigRender.shape.CIRCLE,
					globalAlpha: 0.2,
					stroke: true,
					fill: true,
					strokeStyle: 'purple',
					fillStyle: 'pink'
				}
			});
		}

		//shape test
		function shapeTest() {
			setupTest('Shape Test');

			//draw a diamond
			r.addCommand({type: bigRender.command.DRAW_SHAPE, shape: bigRender.shape.RECTANGLE, translateX: 30, translateY: 30, width: 20, height: 20, stroke: true, fill: false, strokeStyle: '#123456', rotation: 45});

			//draw a triangle
			r.addCommand({type: bigRender.command.DRAW_SHAPE, shape: bigRender.shape.POLYGON, sides: 3, translateX: 50, translateY: 125, rotation: 30, radius: 40, stroke: false, fill: true, fillStyle: 'blue'});

			//draw a circle
			r.addCommand({type: bigRender.command.DRAW_SHAPE, shape: bigRender.shape.CIRCLE, x: 100, y: 70, radius: 25, strokeStyle: 'green', fillStyle: 'purple'});

			//draw a star
			r.addCommand({type: bigRender.command.DRAW_SHAPE, shape: bigRender.shape.STAR, x: 150, y: 20, radius: 15, stroke:true, fill:true, fillStyle: 'yellow', strokeStyle: 'orange', lineWidth: 1});

			//draw a hexagon
			r.addCommand({type: bigRender.command.DRAW_SHAPE, shape: bigRender.shape.POLYGON, sides: 6, x: 150, y: 150, radius: 20, stroke:true, fill:true, fillStyle: 'red', strokeStyle: 'darkred', lineWidth: 10});
		}


		//flood fill test
		function fillTest() {
			setupTest('Flood Fill Test');

			//draw a diamond
			r.addCommand({type: bigRender.command.DRAW_SHAPE, shape: bigRender.shape.RECTANGLE, translateX: 30, translateY: 30, width: 20, height: 20, stroke: true, fill: false, strokeStyle: '#123456', rotation: 45});

			//
			r.addCommand({type: bigRender.command.FLOOD_FILL, x: 50, y: 50, fillStyle: 'purple'});
		}


		//object test
		function objTest() {
			setupTest('Object Test');
			r.addCommand({type: bigRender.command.ADD_OBJECT, src: 'img/tree.jpeg', objectId: 1, x: 20, y: 100, scaleX: 0.20, scaleY: 0.20, regX: 'center', regY: 'center'});
			r.addCommand({type: bigRender.command.ADD_OBJECT, src: 'img/tree.jpeg', objectId: 2, x: 60, y: 100, scaleX: 0.20, scaleY: 0.20, regX: 'center', regY: 'center'});
			r.addCommand({type: bigRender.command.ADD_OBJECT, src: 'img/tree.jpeg', objectId: 3, x: 100, y: 100, scaleX: 0.20, scaleY: 0.20, regX: 'center', regY: 'center'});
			r.addCommand({type: bigRender.command.ADD_OBJECT, src: 'img/tree.jpeg', objectId: 4, x: 140, y: 100, scaleX: 0.20, scaleY: 0.20, regX: 'center', regY: 'center'});
			r.addCommand({type: bigRender.command.MOVE_OBJECT, objectId: 3, rotation: 180});
		}


		//long draw test
		function longDrawTest() {
			setupTest('Long Draw Test');
			for(var i=0; i<10000; i++) {
				var x1 = Math.random() * r.width;
				var y1 = Math.random() * r.height;
				var x2 = Math.random() * r.width;
				var y2 = Math.random() * r.height;
				r.addCommand({type: bigRender.command.DRAW_LINE, path: [x1, y1, x2, y2], lineWidth: 1, strokeStyle: '#123456', globalAlpha: 0.25});
			}
		}


		//layer test
		function layerTest() {
			setupTest('Layer Test');
			r.addCommand({type: bigRender.command.CREATE_LAYER, layerId: 2, scrollPerc: 0, alpha: 0.75});
			r.addCommand({type: bigRender.command.CREATE_LAYER, layerId: 3, scrollPerc: 0.33, alpha: 0.66});
			r.addCommand({type: bigRender.command.CREATE_LAYER, layerId: 4, scrollPerc: 0.66, alpha: 0.33});

			r.addCommand({type: bigRender.command.DRAW_SHAPE, shape: bigRender.shape.CIRCLE, layerId: 2, x: 100, y: 100, radius: 50, strokeStyle: 'green', fillStyle: 'purple'});
			r.addCommand({type: bigRender.command.DRAW_SHAPE, shape: bigRender.shape.CIRCLE, layerId: 3, x: 100, y: 100, radius: 50, strokeStyle: 'green', fillStyle: 'purple'});
			r.addCommand({type: bigRender.command.DRAW_SHAPE, shape: bigRender.shape.CIRCLE, layerId: 4, x: 100, y: 100, radius: 50, strokeStyle: 'green', fillStyle: 'purple'});

			beginRandomScrolling();
		}

		var callbackId;
		var scrollX = 0;
		var scrollY = 0;
		function beginRandomScrolling() {
			endRandomScrolling();
			animationHandler();
		}
		function endRandomScrolling() {
			window.cancelAnimationFrame(callbackId);
		}
		function animationHandler() {
			scrollX += .5;
			scrollY += .5;
			if(scrollX > 100) {
				scrollX = -100;
			}
			if(scrollY > 100) {
				scrollY = -100;
			}
			r.scroll(scrollX, scrollY);
			callbackId = window.requestAnimationFrame(animationHandler);
		}
	</script>

</body>
</html>