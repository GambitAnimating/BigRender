var bigRender=bigRender||{};bigRender.event={DATA_CHANGED:"dataChanged",DIMENSIONS_CHANGED:"dimensionsChanged",TARGET_LAYER_CHANGED:"targetLayerChanged",HIGHLIGHT_LAYER_CHANGED:"highlightLayerChanged",LAYER_ADDED:"layerAdded",LAYER_REMOVED:"layerRemoved",LAYER_CHANGED:"layerChanged",COMMAND_POS_CHANGED:"commandPosChanged",SCROLL_CHANGED:"scrollChanged",COMPLETE:"complete",PROGRESS:"progress"},bigRender.command={CREATE_LAYER:"createLayer",DELETE_LAYER:"deleteLayer",EDIT_LAYER:"editLayer",ADD_OBJECT:"addObject",MOVE_OBJECT:"moveObject",REMOVE_OBJECT:"removeObject",MOVE_RECT:"moveRect",ERASE_RECT:"eraseRect",DRAW_LINE:"drawLine",DRAW_SHAPE:"drawShape",DRAW_IMAGE:"drawImage"},bigRender.option={LAYER_DEPTH:"layerDepth",LAYER_OPACITY:"layerOpacity",LAYER_SCALE:"layerScale",LAYER_NAME:"layerName",BRUSH:"brush",BLEND_MODE:"blendMode",PATH:"path",SHAPE:"shape",ROTATION:"rotation",LINE_OPACITY:"lineOpacity",LINE_COLOR:"lineColor",LINE_THICKNESS:"lineThickness",FILL_OPACITY:"fillOpacity",FILL_COLOR:"fillColor"},bigRender.brush={SMOOTH:"smooth",PIXEL:"pixel"},bigRender.blendMode={NORMAL:"normal",ERASE:"erase"},bigRender.shape={RECTANGLE:"rectangle",ELLIPSE:"ellipse",TRIANGLE:"triangle",STAR:"star"};var bigRender=bigRender||{};!function(){"use strict";var a=function(a){this.model=a,this.commandDispatcher=new bigRender.CommandDispatcher(a,null),this.layerManager=new bigRender.LayerManager(a,this.commandDispatcher)},b=a.prototype;b.addCommand=function(a){var b=this.model;b.commands.length>b.targetCommandPos&&b.commands.slice(0,b.targetCommandPos),b.commands.length===b.targetCommandPos&&b.targetCommandPos++,b.commands.push(a),this.commandDispatcher.start()},b.replaceLastCommand=function(a){this.clearLastCommand(),this.addCommand(a)},b.clearLastCommand=function(){var a=this.model;a.commands.length>0&&(a.targetCommandPos--,this.commandDispatcher.start(),a.commands.pop())},b.highlightLayer=function(a){this.model.highlightLayer=a},b.getSaveObj=function(){var a=this.model,b={};b.v=5,b.data=a.data,b.layers=[],b.width=a.width,b.height=a.height;for(var c=0;c<a.layers.length;c++){var d=a.layers[c];b.layers.push(d.getSaveObj())}return b},b.setSaveObj=function(a){this.clear();var b=this.model;b.setData(a.data),b.setDimensions(a.width,a.height);for(var c=0;c<a.layers.length;c++){var d=a.layers[c],e=this.layerManager.createLayer();e.setSaveObj(d)}},b.undo=function(){this.model.targetCommandPos>0&&(this.model.targetCommandPos--,this.commandDispatcher.start())},b.redo=function(){this.model.targetCommandPos<this.model.commands.length&&(this.model.targetCommandPos++,this.commandDispatcher.start())},b.clear=function(){this.commandDispatcher.clear(),this.model.restoreDefaults()},b.remove=function(){this.commandDispatcher.remove(),this.commandDispatcher=null,this.layerManager.remove(),this.layerManager=null},bigRender.CompositionController=a}();var bigRender=bigRender||{};!function(){"use strict";var a=function(a,b){this.model=a,this.commandDispatcher=b;var c=this;c._doCreateLayer=function(a){var b=a.command;b.layerId=b.layerId||c.model.nextLayerId++,c.createLayer(b.layerId)},c._undoCreateLayer=function(a){var b=c.model.getLayerById(a.command.layerId);b&&(c.model.removeLayer(b),c._pickDefaultTargetLayer(b))},c._doDeleteLayer=function(a){var b=c.model.getLayerById(a.command.layerId);b&&(a.command.deletedLayer=b,c.model.removeLayer(b),c._pickDefaultTargetLayer(b))},c._undoDeleteLayer=function(a){var b=a.command.deletedLayer;c.model.addLayer(b)},c._doEditLayer=function(a){var b=c.model.getLayerById(a.command.layerId);b&&(a.command.oldOptions=b.copyOptions(),b.setOptions(a.command))},c._undoEditLayer=function(a){var b=c.model.getLayerById(a.command.layerId);b&&b.setOptions(a.command.oldOptions)},this._createListeners()},b=a.prototype;b.createLayer=function(a){var b=new bigRender.LayerModel;return b.layerId=a||this.model.nextLayerId++,this.model.addLayer(b),b},b.remove=function(){this._removeListeners(),this.model=null,this.commandDispatcher=null},b._createListeners=function(){var a=this.commandDispatcher;a.addEventListener(bigRender.command.CREATE_LAYER+"Do",this._doCreateLayer),a.addEventListener(bigRender.command.CREATE_LAYER+"Undo",this._undoCreateLayer),a.addEventListener(bigRender.command.DELETE_LAYER+"Do",this._doDeleteLayer),a.addEventListener(bigRender.command.DELETE_LAYER+"Undo",this._undoDeleteLayer),a.addEventListener(bigRender.command.EDIT_LAYER+"Do",this._doEditLayer),a.addEventListener(bigRender.command.EDIT_LAYER+"Undo",this._undoEditLayer)},b._removeListeners=function(){var a=this.commandDispatcher;a.removeEventListener(bigRender.command.CREATE_LAYER+"Do",this._doCreateLayer),a.removeEventListener(bigRender.command.CREATE_LAYER+"Undo",this._undoCreateLayer),a.removeEventListener(bigRender.command.DELETE_LAYER+"Do",this._doDeleteLayer),a.removeEventListener(bigRender.command.DELETE_LAYER+"Undo",this._undoDeleteLayer),a.removeEventListener(bigRender.command.EDIT_LAYER+"Do",this._doEditLayer),a.removeEventListener(bigRender.command.EDIT_LAYER+"Undo",this._undoEditLayer)},b._pickDefaultTargetLayer=function(a){var b=this.model;b.targetLayer&&b.targetLayer!==a||b.layers.length>0&&b.setTargetLayer(b.layers[0])},bigRender.LayerManager=a}();var bigRender=bigRender||{};!function(){"use strict";var a=function(){this.restoreDefaults()},b=a.prototype;createjs.EventDispatcher.initialize(b),b.restoreDefaults=function(){this.layers=[],this.targetLayer=null,this.highlightLayer=null,this.nextLayerId=1,this.commands=[],this.targetCommandPos=0,this.data={},this.scrollX=0,this.scrollY=0,this.width=200,this.height=200,this.multiImage=!1},b.setDimensions=function(a,b){this.width=a,this.height=b,this.dispatchEvent({type:bigRender.event.DIMENSIONS_CHANGED,width:a,height:b})},b.setData=function(a){this.data=a,this.dispatchEvent({type:bigRender.event.DATA_CHANGED,data:a})},b.setTargetLayer=function(a){this.targetLayer=a,this.dispatchEvent({type:bigRender.event.TARGET_LAYER_CHANGED,targetLayer:a})},b.addLayer=function(a){this.layers.push(a),this.dispatchEvent({type:bigRender.event.LAYER_ADDED,layer:a})},b.removeLayer=function(a){var b=this.layers.indexOf(a);-1!==b&&(this.layers.splice(b,1),this.dispatchEvent({type:bigRender.event.LAYER_REMOVED,layer:a}))},b.setScroll=function(a,b){this.scrollX=a,this.scrollY=b,this.dispatchEvent({type:bigRender.event.SCROLL_CHANGED,scrollX:a,scrollY:b})},b.setTargetCommandPos=function(a){this.targetCommandPos=a,this.dispatchEvent({type:bigRender.event.TARGET_CHANGED,targetCommandPos:targetCommandPos})},b.getLayerById=function(a){for(var b=0;b<this.layers.length;b++){var c=this.layers[b];if(c.layerId===a)return c}},bigRender.CompositionModel=a}();var bigRender=bigRender||{};!function(){"use strict";var a=function(){this.commands=[],this.commandPos=0,this.layerId=null,this.name="Layer",this.zIndex=0,this.opacity=1,this.scrollPerc=1,this.visible=!0,this.active=!0},b=a.prototype;createjs.EventDispatcher.initialize(b),b.setOptions=function(a){this.name=a.name||this.name,this.zIndex=a.zIndex||this.zIndex,this.opacity=a.opacity||this.opacity,this.scrollPerc=a.scrollPerc||this.scrollPerc,this.visible=a.visible||this.visible,this.active=a.active||this.active,this.dispatchEvent(bigRender.event.LAYER_CHANGED)},b.copyOptions=function(){var a=JSON.parse(JSON.stringify(this));return a},bigRender.LayerModel=a}();var bigRender=bigRender||{};!function(){"use strict";var a=function(a,b,c){this.model=b,this.queue=c,this.canvas=a,this.stage=new createjs.Stage(this.canvas),this.layers=[],this._addListeners()},b=a.prototype;b._addListeners=function(){var a=this.model;a.addEventListener(bigRender.event.TARGET_LAYER_CHANGED,this._targetLayerChangedHandler),a.addEventListener(bigRender.event.HIGHLIGHT_LAYER_CHANGED,this._highlightLayerChangedHandler),a.addEventListener(bigRender.event.LAYER_ADDED,this._layerAddedHandler),a.addEventListener(bigRender.event.LAYER_REMOVED,this._layerRemovedHandler),a.addEventListener(bigRender.event.LAYER_CHANGED,this._layerChangedHandler),a.addEventListener(bigRender.event.COMMAND_POS_CHANGED,this._commandPosChangedHandler),a.addEventListener(bigRender.event.SCROLL_CHANGED,this._scrollChangedHandler)},b._removeListeners=function(){var a=this.model;a.removeEventListener(bigRender.event.TARGET_LAYER_CHANGED,this._targetLayerChangedHandler),a.removeEventListener(bigRender.event.HIGHLIGHT_LAYER_CHANGED,this._highlightLayerChangedHandler),a.removeEventListener(bigRender.event.LAYER_ADDED,this._layerAddedHandler),a.removeEventListener(bigRender.event.LAYER_REMOVED,this._layerRemovedHandler),a.removeEventListener(bigRender.event.LAYER_CHANGED,this._layerChangedHandler),a.removeEventListener(bigRender.event.COMMAND_POS_CHANGED,this._commandPosChangedHandler),a.removeEventListener(bigRender.event.SCROLL_CHANGED,this._scrollChangedHandler)},b._targetLayerChangedHandler=function(){},b._highlightLayerChangedHandler=function(a){var b=a.command.layer;b?_.each(this.layers,function(a){a.layerModel===b?a.setModOpacity(1):a.setModOpacity(.5)}):_.each(this.layers,function(a){a.setModOpacity(1)})},b._layerAddedHandler=function(a){var b=new LayerView(this.model,a.command.layerId);this.stage.addChild(b),this.layers.push(b),this._sortLayers()},b._layerRemovedHandler=function(a){var b=_.find(this.layers,function(b){return b.layerId===a.command.layerId});b&&(b.remove(),this.layers=_.without(this.layers,b)),this._sortLayers()},b._layerChangedHandler=function(){},b._commandPosChangedHandler=function(){},b._scrollChangedHandler=function(a){for(var b=0;b<this.layers.length;b++){var c=this.layers[b];c.setScroll(a.command.x,a.command.y)}},b._sortLayers=function(){this.layers.sort(function(a,b){return a.z-b.z});for(var a=0;a<this.layers.length;a++){var b=this.layers[a];b.setDepth(a)}},b.remove=function(){this._removeListeners()},bigRender.CompositionView=a}();var bigRender=bigRender||{};!function(){"use strict";var a=function(a,b){createjs.Bitmap.call(this,a),this.commandDispatcher=b,this._restoreDefaults(),this._addListeners()},b=a.prototype=new createjs.Bitmap;b.remove=function(){this._removeListeners()},b._restoreDefaults=function(){this.brush=bigRender.brush.SMOOTH,this.blendMode=bigRender.blendMode.NORMAL,this.lineThickness=3,this.lineColor="#121212",this.lineOpacity=100,this.fillColor="#343434",this.fillOpacity=100,this.lineColor="#123456",this.lineOpacity=100,this.lineThickness=3,this.shape=bigRender.shape.RECTANGLE,this.rotation=0},b._addListeners=function(){var a=this.commandDispatcher;a.addEventListener(bigRender.command.DRAW_IMAGE+"Do",this._doDrawImage),a.addEventListener(bigRender.command.DRAW_IMAGE+"Undo",this._redraw),a.addEventListener(bigRender.command.DRAW_LINE+"Do",this._doDrawLine),a.addEventListener(bigRender.command.DRAW_LINE+"Undo",this._redraw),a.addEventListener(bigRender.command.DRAW_SHAPE+"Do",this._doDrawShape),a.addEventListener(bigRender.command.DRAW_SHAPE+"Undo",this._redraw),a.addEventListener(bigRender.command.ERASE_RECT+"Do",this._doEraseRect),a.addEventListener(bigRender.command.ERASE_RECT+"Undo",this._redraw),a.addEventListener(bigRender.command.MOVE_RECT+"Do",this._doMoveRect),a.addEventListener(bigRender.command.MOVE_RECT+"Undo",this._redraw)},b._removeListeners=function(){var a=this.commandDispatcher;a.removeEventListener(bigRender.command.DRAW_IMAGE+"Do",this._doDrawImage),a.removeEventListener(bigRender.command.DRAW_IMAGE+"Undo",this._redraw),a.removeEventListener(bigRender.command.DRAW_LINE+"Do",this._doDrawLine),a.removeEventListener(bigRender.command.DRAW_LINE+"Undo",this._redraw),a.removeEventListener(bigRender.command.DRAW_SHAPE+"Do",this._doDrawShape),a.removeEventListener(bigRender.command.DRAW_SHAPE+"Undo",this._redraw),a.removeEventListener(bigRender.command.ERASE_RECT+"Do",this._doEraseRect),a.removeEventListener(bigRender.command.ERASE_RECT+"Undo",this._redraw),a.removeEventListener(bigRender.command.MOVE_RECT+"Do",this._doMoveRect),a.removeEventListener(bigRender.command.MOVE_RECT+"Undo",this._redraw)},b._doDrawImage=function(){},b._doDrawLine=function(){},b._doDrawShape=function(){},b._doEraseRect=function(){},b._doMoveRect=function(){},b._redraw=function(){},bigRender.LayerBitmapView=a}();var bigRender=bigRender||{};!function(){"use strict";var a=function(a){createjs.Container.call(this),this.commandDispatcher=a,this._addListeners()},b=a.prototype=new createjs.Container;b.remove=function(){this._removeListeners()},b._addListeners=function(){var a=this.commandDispatcher;a.addEventListener(bigRender.command.ADD_OBJECT+"Do",this._doAddObject),a.addEventListener(bigRender.command.ADD_OBJECT+"Undo",this._undoAddObject),a.addEventListener(bigRender.command.MOVE_OBJECT+"Do",this._doMoveObject),a.addEventListener(bigRender.command.MOVE_OBJECT+"Undo",this._undoMoveObject),a.addEventListener(bigRender.command.REMOVE_OBJECT+"Do",this._doRemoveObject),a.addEventListener(bigRender.command.REMOVE_OBJECT+"Undo",this._undoRemoveObject)},b._removeListeners=function(){var a=this.commandDispatcher;a.removeEventListener(bigRender.command.ADD_OBJECT+"Do",this._doAddObject),a.removeEventListener(bigRender.command.ADD_OBJECT+"Undo",this._undoAddObject),a.removeEventListener(bigRender.command.MOVE_OBJECT+"Do",this._doMoveObject),a.removeEventListener(bigRender.command.MOVE_OBJECT+"Undo",this._undoMoveObject),a.removeEventListener(bigRender.command.REMOVE_OBJECT+"Do",this._doRemoveObject),a.removeEventListener(bigRender.command.REMOVE_OBJECT+"Undo",this._undoRemoveObject)},b._doAddObject=function(){},b._undoAddObject=function(){},b._doMoveObject=function(){},b._undoMoveObject=function(){},b._doRemoveObject=function(){},b._undoRemoveObject=function(){},bigRender.LayerObjectView=a}();var bigRender=bigRender||{};!function(){var a=function(a,b,c){createjs.Container.call(this),this.layer=b,this.commandDispatcher=new bigRender.CommandDispatcher(b,c),this.bitmap=new bigRender.LayerBitmapView(this.canvas,this.commandDispatcher),this.objectHolder=new bigRender.LayerObjectView(this.commandDispatcher),this.addChild(this.bitmap),this.addChild(this.objectHolder)},b=a.prototype=new createjs.Container;b._addListeners=function(){},b._removeListeners=function(){},b.getObjectsUnderPoint=function(a,b){return this.objectHolder.getObjectsUnderPoint(a,b)},b.getObjectsUnderRect=function(a){return this.objectHolder.getObjectsUnderRect(a)},b.copy=function(){},b.clear=function(){},bigRender.LayerView=a}();